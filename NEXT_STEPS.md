# 次のステップ提案

## 🎯 今週やるべきこと（優先度: 最高）

### 1. 重複ファイルの整理とコードクリーンアップ
**理由**: コードベースの保守性を向上させ、混乱を避けるため
**所要時間**: 2-3時間
**リスク**: 低（既存機能への影響を確認しながら進める）

**削除対象ファイル**:
- `backend/src/controllers/authController.ts` (旧) → `auth.controller.ts` (新) を使用
- `backend/src/services/calendarService.ts` (旧) → `calendar.service.ts` (新) を使用
- `backend/src/services/syncService.ts` (旧) → `sync.service.ts` (新) を使用
- `backend/src/models/canonicalEventModel.ts` (旧) → `canonical-event.model.ts` (新) を使用
- `backend/src/models/eventLinkModel.ts` (旧) → `event-link.model.ts` (新) を使用
- `backend/src/workers/syncWorker.ts` (旧) → `sync.worker.ts` (新) を使用
- `backend/src/queues/syncQueue.ts` (旧) → `sync.queue.ts` (新) を使用
- `frontend/src/pages/DashboardPage.tsx` (旧) → `Dashboard.tsx` (新) を使用
- `frontend/src/pages/LoginPage.tsx` (旧) → `Login.tsx` (新) を使用

**実装手順**:
1. 各ファイルの使用箇所を検索（30分）
2. インポート文を新ファイルに更新（30分）
3. 旧ファイルを削除（10分）
4. ビルドエラーを確認・修正（1時間）
5. 動作確認（30分）

**完了条件**:
- [ ] すべての旧ファイルが削除されている
- [ ] ビルドエラーがない
- [ ] 主要機能が正常に動作する

---

### 2. 認証フローの完成とテスト
**理由**: ログイン後の画面遷移とユーザー情報取得が正しく動作する必要がある
**所要時間**: 1-2時間
**依存関係**: `/api/auth/me`エンドポイントの実装確認

**実装内容**:
1. `/api/auth/me`エンドポイントの実装確認・修正
2. `useAuth.ts`のエラーハンドリング強化
3. `AuthCallback.tsx`の動作確認
4. セッション管理の確認

**ファイル**:
- `backend/src/controllers/auth.controller.ts` - `/api/auth/me`エンドポイント
- `frontend/src/hooks/useAuth.ts` - 認証フック
- `frontend/src/pages/AuthCallback.tsx` - コールバック処理

**実装手順**:
1. `/api/auth/me`エンドポイントの実装確認（30分）
2. フロントエンドのエラーハンドリング強化（30分）
3. ログイン→ダッシュボード遷移のテスト（30分）
4. セッション有効期限の処理確認（30分）

**完了条件**:
- [ ] ログイン後、正しくダッシュボードに遷移する
- [ ] ユーザー情報が正しく表示される
- [ ] トークン期限切れ時に適切にログアウトされる
- [ ] エラー時に適切なメッセージが表示される

---

### 3. データベースマイグレーションの確認と実行
**理由**: 本番環境へのデプロイ前に必須
**所要時間**: 1時間
**リスク**: 中（既存データがある場合はバックアップが必要）

**実装手順**:
1. マイグレーションファイルの確認（15分）
2. 開発環境でマイグレーション実行（15分）
3. テーブル存在確認SQLの実行（15分）
4. データ整合性の確認（15分）

**完了条件**:
- [ ] すべてのテーブルが正しく作成されている
- [ ] マイグレーション履歴が記録されている
- [ ] 既存データに問題がない

---

## 📅 来週やるべきこと（優先度: 高）

### 4. 同期機能のUI統合と動作確認
**理由**: コア機能の一つであり、ユーザーが実際に使える状態にする必要がある
**所要時間**: 3-4時間
**依存関係**: 重複ファイル整理完了後

**実装内容**:
1. ダッシュボードの同期ステータス表示の動作確認
2. 手動同期トリガーの実装確認
3. 同期ログの表示確認
4. エラーハンドリングの強化

**ファイル**:
- `frontend/src/components/SyncStatus.tsx`
- `frontend/src/components/SyncLog.tsx`
- `frontend/src/pages/Dashboard.tsx`

**実装手順**:
1. 同期APIの動作確認（1時間）
2. UIコンポーネントの動作確認（1時間）
3. エラーハンドリングの追加（1時間）
4. ローディング状態の改善（1時間）

**完了条件**:
- [ ] ダッシュボードで同期ステータスが正しく表示される
- [ ] 手動同期をトリガーできる
- [ ] 同期ログが正しく表示される
- [ ] エラー時に適切なメッセージが表示される

---

### 5. イベント作成機能の完成とテスト
**理由**: FreeBusy検索で見つけた空き時間に予定を作成できる必要がある
**所要時間**: 2-3時間
**依存関係**: カレンダーAPIの実装確認

**実装内容**:
1. `SlotCard`コンポーネントの動作確認
2. イベント作成APIの動作確認
3. 成功・失敗時のフィードバック改善
4. 作成後の空き時間検索結果の更新

**ファイル**:
- `frontend/src/pages/components/SlotCard.tsx`
- `frontend/src/services/calendarService.ts`
- `backend/src/controllers/calendarController.ts`

**実装手順**:
1. イベント作成APIの動作確認（1時間）
2. UIの動作確認と改善（1時間）
3. エラーハンドリングの追加（30分）
4. 成功時のフィードバック改善（30分）

**完了条件**:
- [ ] 空き時間から予定を作成できる
- [ ] 作成成功時に適切なメッセージが表示される
- [ ] エラー時に適切なメッセージが表示される
- [ ] 作成後、検索結果が更新される（オプション）

---

### 6. 競合解決UIの動作確認と改善
**理由**: 双方向同期のコア機能であり、ユーザーが競合を解決できる必要がある
**所要時間**: 2-3時間

**実装内容**:
1. 競合検出機能の動作確認
2. 競合解決UIの動作確認
3. 手動マージ機能の動作確認
4. エラーハンドリングの強化

**ファイル**:
- `frontend/src/pages/ConflictDetail.tsx`
- `frontend/src/components/ConflictDiff.tsx`
- `frontend/src/components/ManualMergeModal.tsx`

**実装手順**:
1. 競合検出APIの動作確認（1時間）
2. UIコンポーネントの動作確認（1時間）
3. エラーハンドリングの追加（1時間）

**完了条件**:
- [ ] 競合が正しく検出される
- [ ] 競合詳細が正しく表示される
- [ ] 競合を解決できる
- [ ] エラー時に適切なメッセージが表示される

---

## 🔧 中期対応（1-2週間以内）

### 7. エラーハンドリングの統一と強化
**理由**: ユーザー体験の向上とデバッグの容易化
**所要時間**: 4-5時間

**実装内容**:
1. エラーメッセージの統一
2. エラーロギングの実装
3. ユーザーフレンドリーなエラーメッセージ
4. リトライ機能の実装（必要に応じて）

**ファイル**:
- `frontend/src/services/api.ts` - エラーインターセプター
- `backend/src/middleware/errorHandler.ts` - エラーハンドリング
- 各サービスファイル

---

### 8. ローディング状態とスケルトンUIの実装
**理由**: ユーザー体験の向上
**所要時間**: 3-4時間

**実装内容**:
1. 各ページにローディング状態を追加
2. スケルトンUIコンポーネントの作成
3. データフェッチ中の適切な表示

---

### 9. テストコードの追加
**理由**: コード品質の向上とリグレッション防止
**所要時間**: 1週間

**実装内容**:
1. バックエンドのユニットテスト
2. フロントエンドのコンポーネントテスト
3. API統合テスト

---

## 🚫 今はやらないこと

### Push通知（watch）の最適化
**理由**: 現在の実装で動作しているため、優先度は低い
**後回しにする条件**: Phase 2が完全に完了してから

### Notion連携
**理由**: コア機能ではない、拡張機能として後で追加
**後回しにする条件**: MVPが完全に動作してから

### パフォーマンス最適化
**理由**: 機能が完成してから最適化する方が効率的
**後回しにする条件**: すべてのコア機能が動作してから

### 多言語対応
**理由**: 現時点では日本語のみで十分
**後回しにする条件**: 海外展開を検討する段階になってから

---

## 📊 優先度マトリックス

| 機能 | ビジネス価値 | 技術的難易度 | 依存関係 | 優先度 |
|------|------------|------------|---------|--------|
| 重複ファイル整理 | 中 | 低 | なし | 🔴 最高 |
| 認証フロー完成 | 高 | 低 | `/api/auth/me` | 🔴 最高 |
| DBマイグレーション確認 | 高 | 低 | なし | 🔴 最高 |
| 同期機能UI統合 | 高 | 中 | 重複ファイル整理 | 🟠 高 |
| イベント作成機能 | 高 | 低 | カレンダーAPI | 🟠 高 |
| 競合解決UI | 高 | 中 | なし | 🟠 高 |
| エラーハンドリング | 中 | 中 | なし | 🟡 中 |
| ローディング状態 | 中 | 低 | なし | 🟡 中 |
| テストコード | 中 | 高 | 機能完成 | 🟡 中 |

---

## 🎯 今週の目標

1. ✅ 重複ファイルの整理完了
2. ✅ 認証フローの動作確認完了
3. ✅ データベースマイグレーションの確認完了
4. ⏳ 同期機能のUI統合開始

これらのタスクを完了することで、プロジェクトの基盤が安定し、次の機能開発に集中できるようになります。
